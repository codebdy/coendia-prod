---
import { PageType } from "@rxdrag/rxcms-models";
import Layout from "@/layouts/Layout.astro";
import { rx } from "theme";
import { rxPage } from "@rxdrag/website-lib-core";
import { Meta } from "@rxdrag/website-lib";
import ProductsPage from "@/components/ProductsPage.astro";
import CtaBlock from "@/components/CtaBlock.astro";
import Footer from "@/components/Footer.astro";
import Globals from "@/components/Globals.astro";
// Получение параметров из пути URL
const { slug } = Astro.params || {};
// Получение информации о пагинации из props
const { currentPage, pageSize, totalPages } = Astro.props;
export async function getStaticPaths() {
  return await rx.getCategoredProductListPaths();
}
// Получение данных о продуктах
const products = await rx.getProducts(
  {
    category: String(slug),
    page: currentPage,
    pageSize,
  },
  { width: 500, height: 500 }
);
// Создание объекта пагинации
const pagination = rxPage.productsPagination({
  currentPage,
  totalPages: totalPages,
  baseUrl: `/products/categories/${String(slug)}/`,
});
const category = slug
  ? await rx.getProductCategoryBySlug(String(slug))
  : undefined;
const meta = (await rx.getPageByType(PageType.ProductList))?.meta;---

<Layout>
  <Meta title={category?.name || "Продукты"} slot="meta" content={meta} />
  <ProductsPage
    products={products}
    pagination={pagination}
    category={category}
  />
  <CtaBlock />
  <Footer />
  
  <Globals />
</Layout>