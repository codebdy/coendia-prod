---
import Layout from "@/layouts/Layout.astro";
import { rx } from "theme";
import { rxPage } from "@rxdrag/website-lib-core";
import { Meta } from "@rxdrag/website-lib";
import Header from "@/components/Header.astro";
import Breadcrumb from "@/components/Breadcrumb.astro";
import CtaBlock from "@/components/CtaBlock.astro";
import Footer from "@/components/Footer.astro";
import MiniFloat from "@/components/MiniFloat.astro";
import Globals from "@/components/Globals.astro";

// 生成面包屑导航
const breadcrumbs = rxPage.breadcrumbs("技术能力", "首页");
const meta = (await rx.getPageBySlug("service"))?.meta;
// 技术工艺卡片数据
const technologyCards = [
  {
    title: "高精度激光切割",
    description: `φ0.3–φ15mm管材高精度切割;切割精度±0.02mm,复杂切口可精准实现。优质激光源和稳定传输确保可靠连续运行。`,
    badges: ["φ0.3–φ15mm", "±0.02mm", "连续稳定"],
    tag: "±0.02mm",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/d3fb0ab1-a916-4f0e-b08c-6046abf2efdd.jpg",
  },
  {
    title: "内窥镜蛇骨铆接",
    description: `自动化高精度铆接,最小蛇骨可达φ1.8mm;铆接精度≤±0.02mm,连接牢固、运动灵活。`,
    badges: ["φ1.8mm最小", "±0.02mm", "自动化"],
    tag: "±0.02mm",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/9760c5d2-2a8a-4464-86c9-d1b4a0a7ddfb.jpg",
  },
  {
    title: "内窥镜蛇骨焊接",
    description: `精密焊接,最小焊点直径0.1mm;惰性气体保护防止氧化。通过高/低温/振动测试,无开裂或脱落,可靠性优异。`,
    badges: ["0.1mm焊点直径", "惰性保护", "环境应力验证"],
    tag: "焊点直径≥0.1mm",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/54993837-9375-4321-8579-202d9dad329f.jpg",
  },
  {
    title: "微型摄像头焊接",
    description: `自研自动化设备实现高精度焊接,摄像头与PCB连接偏差≤0.01mm;激光焊接热影响区小,图像识别实时监控质量。`,
    badges: ["≤0.01mm", "激光焊接", "视觉监控"],
    tag: "偏差≤0.01mm",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/eb46c5bd-6b69-4501-8ce8-a9005ac8a5fb.jpg",
  },
  {
    title: "洁净精密注塑",
    description: `具备设计和制造能力;先进的注塑和模具技术,表面光滑无气泡/缩痕;自动上料、脱模和检测,高效率且质量稳定。`,
    badges: ["自动化", "外观优异", "一致性"],
    tag: "+0.5℃",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/fc989135-fa1f-4c0e-abf5-57c5c96b6fbd.jpg",
  },
  {
    title: "涂层管挤出",
    description: `φ0.5–φ15mm管材精密挤出涂层,涂层厚度0.05–0.5mm;采用高精度挤出模具和温控系统,确保涂层均匀致密、附着力强。`,
    badges: ["φ0.5–φ15mm", "0.05–0.5mm", "高附着力"],
    tag: "φ0.5–φ15mm",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/801eb263-be36-42bd-812f-83206cde7c31.jpg",
  },
  {
    title: "全流程检验",
    description: `覆盖原材料、工艺和成品的综合检验体系;配备高精度测量仪器和自动化检测设备,确保每个阶段的质量控制和数据可追溯。`,
    badges: ["原材料检验", "过程控制", "成品检验"],
    tag: "100%检验",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/7ed3d216-6b09-47c8-875c-8636f26a45ab.jpg",
  },
  {
    title: "内窥镜设计",
    description: `专注于内窥镜底层技术,掌握完整工艺链;结合临床使用场景,提前识别和规避设计风险。`,
    badges: ["底层技术", "工艺闭环", "临床导向"],
    tag: "风险前置",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/41bafb77-f10b-439c-ad0c-80d0603c6bf8.jpg",
  },
  {
    title: "自研设备",
    description: `自主研发激光切割、摄像头焊接、视觉检测、疲劳耐久测试设备,确保质量和产能。`,
    badges: ["自动化", "定制产线", "效率提升"],
    tag: "设备自研",
    img: "https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/e04b8a49-043d-4871-a33b-67a1bfe91ec7.jpg",
  },
];

---

<Layout>
  <Meta slot="meta" content={meta} />
  <Header />
  <Breadcrumb items={breadcrumbs} title="技术能力" bgUrl="https://yizhanfei-prod1.oss-accelerate.aliyuncs.com/4299262263298/e638f635-ccd2-4beb-9896-a650f657308d.jpg" />
  <section class="w-full mt-24">
    <div class="container flex flex-col gap-6">
      <h2 class="block-title">
        核心工艺能力
      </h2>
      <p class="block-subtitle">
        精密工艺 铸就医疗卓越
      </p>
      <div class="mt-8 grid gap-16 grid-cols-1 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 tech-cards-grid">
{
          technologyCards.map((card, index) => (<article class="card group rounded-lg bg-white shadow-sm ring-1 ring-slate-200 overflow-hidden tech-card" data-index={index}>
          <div class="relative aspect-[4/3] bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center overflow-hidden tech-card-image">
          <img class="absolute inset-0 w-full h-full object-cover object-center" src={card.img} alt={card.title} />
          <span class="absolute right-3 top-3 rounded-full bg-black/15 backdrop-blur px-2 py-1 text-xs text-white tech-card-tag">
          {card.tag}
          </span>
          </div>
          <div class="p-5 tech-card-content">
          <h3 class="font-semibold text-slate-900 tech-card-title">
          {card.title}
          </h3>
          <p class="mt-1 text-sm text-slate-600 tech-card-desc">
          {card.description}
          </p>
          <div class="mt-3 flex flex-wrap gap-2 tech-card-badges">
          {
          card.badges.map((badge) => (<span class="text-xs font-medium border border-primary-200 text-gray-600 px-4 py-1 rounded-full">
          {badge}
          </span>))
          }
          </div>
          </div>
          </article>))
        }
      </div>
    </div>
  </section>
</Layout>
<CtaBlock />
<Footer />
<MiniFloat />
<Globals />

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import { pageLoader } from "@rxdrag/website-lib-core";

  gsap.registerPlugin(ScrollTrigger);

  function initTechAnimations() {
    // 查找技术卡片元素
    const techCards = document.querySelectorAll(".tech-card");
    const techGrid = document.querySelector(".tech-cards-grid");

    if (!techCards.length || !techGrid) return;

    // 设置初始状态
    gsap.set(techCards, {
      opacity: 0,
      y: 80,
      scale: 0.95,
    });

    // 根据响应式布局计算每行卡片数量
    const getCardsPerRow = () => {
      const screenWidth = window.innerWidth;
      if (screenWidth >= 1024) return 3; // lg:grid-cols-3
      if (screenWidth >= 768) return 2;  // md:grid-cols-2
      return 1; // grid-cols-1
    };

    // 按行分组卡片并为每行创建独立动画
    const cardsPerRow = getCardsPerRow();
    const totalRows = Math.ceil(techCards.length / cardsPerRow);

    for (let row = 0; row < totalRows; row++) {
      const startIndex = row * cardsPerRow;
      const endIndex = Math.min(startIndex + cardsPerRow, techCards.length);
      const rowCards = Array.from(techCards).slice(startIndex, endIndex);

      if (rowCards.length > 0) {
        // 为每行创建独立的 ScrollTrigger
        gsap
          .timeline({
            scrollTrigger: {
              trigger: rowCards[0],
              start: "top 100%",
              toggleActions: "play none none reverse",
            },
          })
          .to(rowCards, {
            opacity: 1,
            y: 0,
            scale: 1,
            duration: 0.6,
            ease: "power2.out",
            stagger: 0.15,
          });
      }
    }

    // 为每个卡片添加悬停效果
    techCards.forEach((card) => {
      const cardImage = card.querySelector(".tech-card-image");
      const cardTag = card.querySelector(".tech-card-tag");
      const cardContent = card.querySelector(".tech-card-content");

      if (cardImage && cardTag && cardContent) {
        card.addEventListener("mouseenter", () => {
          gsap.to(cardImage, {
            scale: 1.05,
            duration: 0.4,
            ease: "power2.out",
          });
          gsap.to(cardTag, {
            scale: 1.1,
            duration: 0.3,
            ease: "power2.out",
          });
          gsap.to(cardContent, {
            y: -5,
            duration: 0.3,
            ease: "power2.out",
          });
        });

        card.addEventListener("mouseleave", () => {
          gsap.to(cardImage, {
            scale: 1,
            duration: 0.4,
            ease: "power2.out",
          });
          gsap.to(cardTag, {
            scale: 1,
            duration: 0.3,
            ease: "power2.out",
          });
          gsap.to(cardContent, {
            y: 0,
            duration: 0.3,
            ease: "power2.out",
          });
        });
      }
    });
  }

  // 初始化动画
  pageLoader.onLoaded(() => {
    setTimeout(initTechAnimations, 100);
  });
</script>